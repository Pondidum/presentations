### Building a Serverless, EventSourced, Slack Clone
![Serverless](img/logo.png)

##### AndyDote.co.uk &nbsp; | &nbsp; github.com/pondidum &nbsp; | &nbsp; @pondidum
http://stavrapid-official.deviantart.com/art/Half-Life-3-logo-with-logotypes-466077248<!-- .element: class="image-attribution"-->
https://geteventstore.com/<!-- .element: class="image-attribution"-->

Note:
* we're not using EventStore *sadface*
* I work for Lindorff Oy,  helping to build an online payment service



# Why build this?
Note:
* to see if complex apps could be made without a single EC2 instance
* And as you can guess from that, this is AWS based
* practical experience with aws services I havent used before



# Chat App ==  Simple
# right? <!-- .element: class="fragment" -->



* channel_created
* message_sent
* message_edited
* user_joined_channel
* user_left_channel
* user_registered
Note:
* this was my initial idea for structure
* what are our aggregates?
  * can messages be posted to multiple channels at once? (e.g. hashtags on twitter)
  * or are channels owners of messages?
* storage of events
  * store as a single stream?
  * split by aggregate?



<ul class="left">
  <li><h2>UserAggregate</h2></li>
  <li>user_registered</li>
  <li>channel_created</li>
  <li>user_joined_channel</li>
  <li>user_left_channel</li>
</ul>
<ul class="right">
  <li><h2>ChannelAggregate</h2></li>
  <li>channel_created</li>
  <li>user_joined_channel</li>
  <li>user_left_channel</li>
  <li>message_sent</li>
  <li>message_edited</li>
</ul>
Note:
* we have events which multiple aggregates care about
* we can either introduce a separation



<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="611px" height="581px" version="1.1"><defs/><g transform="translate(0.5,0.5)"><path d="M 39 290 L 210 290 L 210 230 L 233.63 230" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 238.88 230 L 231.88 233.5 L 233.63 230 L 231.88 226.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 39 290 L 210 290 L 210 350 L 233.63 350" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 238.88 350 L 231.88 353.5 L 233.63 350 L 231.88 346.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 39 290 L 110 290 L 110 323.63" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 110 328.88 L 106.5 321.88 L 110 323.63 L 113.5 321.88 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 300 250.19 C 300 255.27 295.68 260 289.62 260 L 250.34 260 C 244.15 260 240 255.09 240 250.23 L 240 209.59 C 240 205.02 244.09 200 250.42 200 L 289.62 200 C 295.76 200 300 204.75 300 210.06 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 300 247.54 L 300 250.19 C 300 255.28 295.68 260 289.62 260 L 250.34 260 C 244.15 260 240 255.09 240 250.23 L 240 247.68 C 240 252.77 244.63 257.35 250.1 257.35 L 289.89 257.35 C 295.34 257.35 300 252.9 300 247.54 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="240" y="200" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 288.85 243.61 C 288.92 243.81 288.8 244 288.62 244.07 L 278.38 247.77 C 278.14 247.85 277.93 247.75 277.86 247.61 L 269.92 228.36 L 259.05 247.17 C 258.96 247.32 258.82 247.38 258.61 247.38 L 251.49 247.38 C 251.25 247.38 251 247.06 251.2 246.77 L 266.58 221.34 C 266.81 220.96 266.78 220.64 266.67 220.36 L 265.24 216.29 C 265.16 216.03 264.98 215.9 264.72 215.9 L 260.24 215.9 C 259.76 215.9 259.67 215.72 259.67 215.35 L 259.67 209.94 C 259.67 209.65 259.73 209.54 260.02 209.54 L 268.94 209.54 C 269.37 209.54 269.49 209.77 269.6 210.03 L 281.65 239.77 L 286.4 238.16 C 286.61 238.09 286.72 238.13 286.79 238.3 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 458.55 270 L 442.69 262.11 L 435 252.33 L 435 243.89 L 437.2 243.66 L 437.2 241.55 L 435 240.21 L 435 231.77 L 437.2 231.77 L 437.2 228.22 L 435 228.22 L 435 219.79 L 437.2 218.44 L 437.2 216.34 L 435 216.1 L 435 207.66 L 442.69 197.88 L 458.55 190 L 480.5 190 L 496.21 197.88 L 505 207.66 L 505 216.1 L 502.04 216.32 L 502.04 218.32 L 505 219.88 L 505 228.22 L 502.04 228.22 L 502.04 231.77 L 505 231.77 L 505 240.33 L 502.04 241.77 L 502.04 243.66 L 505 243.89 L 505 252.33 L 496.21 262.11 L 480.5 270 Z" fill="#2e73b8" stroke="none" pointer-events="none"/><path d="M 458.55 204.77 L 442.69 210.11 L 442.69 197.88 L 458.55 190 Z M 458.55 226.99 L 442.69 227.43 L 442.69 215.25 L 458.55 211.43 Z M 458.55 248.11 L 442.69 244.54 L 442.69 232.56 L 458.55 233.67 Z M 458.55 270 L 442.69 262.11 L 442.69 249.87 L 458.55 254.77 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 505 243.89 L 496.21 249.89 L 480.5 254.77 L 458.55 254.77 L 442.69 249.87 L 442.69 262.11 L 435 252.33 L 435 243.89 L 437.2 243.66 L 437.2 241.55 L 435 240.21 L 435 231.77 L 437.2 231.77 L 437.2 228.22 L 435 228.22 L 435 219.79 L 437.2 218.44 L 437.2 216.34 L 435 216.1 L 435 207.66 L 442.69 197.88 L 442.69 210.11 L 458.55 204.77 L 480.5 204.77 L 496.21 209.89 L 505 216.1 L 502.04 216.32 L 502.04 218.32 L 496.21 215.21 L 480.5 211.43 L 458.55 211.43 L 442.69 215.25 L 442.69 227.43 L 458.55 226.99 L 480.5 226.99 L 496.21 227.55 L 505 228.22 L 502.04 228.22 L 502.04 231.77 L 505 231.77 L 496.21 232.56 L 480.5 233.67 L 458.55 233.67 L 442.69 232.56 L 442.69 244.54 L 458.55 248.11 L 480.5 248.11 L 496.21 244.66 L 502.04 241.77 L 502.04 243.66 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 480.5 204.77 L 480.5 190 L 496.21 197.88 L 496.21 209.89 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 480.5 211.43 L 496.21 215.21 L 496.21 227.55 L 480.5 226.99 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 480.5 233.67 L 496.21 232.56 L 496.21 244.66 L 480.5 248.11 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 480.5 254.77 L 496.21 249.89 L 496.21 262.11 L 480.5 270 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 500 140.19 C 500 145.27 495.68 150 489.62 150 L 450.34 150 C 444.15 150 440 145.09 440 140.23 L 440 99.59 C 440 95.02 444.09 90 450.42 90 L 489.62 90 C 495.76 90 500 94.75 500 100.06 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 500 137.54 L 500 140.19 C 500 145.28 495.68 150 489.62 150 L 450.34 150 C 444.15 150 440 145.09 440 140.23 L 440 137.68 C 440 142.77 444.63 147.35 450.1 147.35 L 489.89 147.35 C 495.34 147.35 500 142.9 500 137.54 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="440" y="90" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 488.85 133.61 C 488.92 133.81 488.8 134 488.62 134.07 L 478.38 137.77 C 478.14 137.85 477.93 137.75 477.86 137.61 L 469.92 118.36 L 459.05 137.17 C 458.96 137.32 458.82 137.38 458.61 137.38 L 451.49 137.38 C 451.25 137.38 451 137.06 451.2 136.77 L 466.58 111.34 C 466.81 110.96 466.78 110.64 466.67 110.36 L 465.24 106.29 C 465.16 106.03 464.98 105.9 464.72 105.9 L 460.24 105.9 C 459.76 105.9 459.67 105.72 459.67 105.35 L 459.67 99.94 C 459.67 99.65 459.73 99.54 460.02 99.54 L 468.94 99.54 C 469.37 99.54 469.49 99.77 469.6 100.03 L 481.65 129.77 L 486.4 128.16 C 486.61 128.09 486.72 128.13 486.79 128.3 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 600 137.47 L 595.96 139.51 L 584.11 136.65 L 584.11 145.42 L 575 150 L 565.84 145.42 L 565.84 136.65 L 554.03 139.51 L 550 137.48 L 550 102.45 L 554.03 100.42 L 565.84 103.24 L 565.84 94.58 L 575 90 L 584.11 94.58 L 584.11 103.24 L 595.96 100.41 L 600 102.45 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 554.03 100.42 L 554.03 139.51 L 550 137.48 L 550 102.45 Z M 575 105.15 L 565.84 107.4 L 565.84 94.58 L 575 90 Z M 575 127.57 L 565.84 126.4 L 565.84 113.59 L 575 112.42 Z M 575 150 L 565.84 145.42 L 565.84 132.6 L 575 134.85 Z M 595.96 139.51 L 584.11 136.65 L 584.11 132.55 L 575 130.92 L 575 127.57 L 584.11 126.4 L 584.11 113.59 L 575 112.42 L 575 109.07 L 584.11 107.4 L 584.11 103.24 L 595.96 100.41 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 575 109.07 L 565.84 107.4 L 575 105.15 L 584.11 107.4 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 584.11 132.65 L 575 134.85 L 565.84 132.6 L 575 130.92 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 98.32 411 L 82.01 403.01 L 74.1 393.11 L 74.1 384.56 L 76.36 384.33 L 76.36 382.19 L 74.1 380.84 L 74.1 372.29 L 76.36 372.29 L 76.36 368.69 L 74.1 368.69 L 74.1 360.16 L 76.36 358.79 L 76.36 356.67 L 74.1 356.43 L 74.1 347.88 L 82.01 337.98 L 98.32 330 L 120.89 330 L 137.05 337.98 L 146.1 347.88 L 146.1 356.43 L 143.05 356.65 L 143.05 358.67 L 146.1 360.25 L 146.1 368.69 L 143.05 368.69 L 143.05 372.29 L 146.1 372.29 L 146.1 380.96 L 143.05 382.42 L 143.05 384.33 L 146.1 384.56 L 146.1 393.11 L 137.05 403.01 L 120.89 411 Z" fill="#2e73b8" stroke="none" pointer-events="none"/><path d="M 98.32 344.95 L 82.01 350.37 L 82.01 337.98 L 98.32 330 Z M 98.32 367.45 L 82.01 367.9 L 82.01 355.57 L 98.32 351.7 Z M 98.32 388.83 L 82.01 385.22 L 82.01 373.09 L 98.32 374.21 Z M 98.32 411 L 82.01 403.01 L 82.01 390.62 L 98.32 395.58 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 146.1 384.56 L 137.05 390.63 L 120.89 395.58 L 98.32 395.58 L 82.01 390.62 L 82.01 403.01 L 74.1 393.11 L 74.1 384.56 L 76.36 384.33 L 76.36 382.19 L 74.1 380.84 L 74.1 372.29 L 76.36 372.29 L 76.36 368.69 L 74.1 368.69 L 74.1 360.16 L 76.36 358.79 L 76.36 356.67 L 74.1 356.43 L 74.1 347.88 L 82.01 337.98 L 82.01 350.37 L 98.32 344.95 L 120.89 344.95 L 137.05 350.14 L 146.1 356.43 L 143.05 356.65 L 143.05 358.67 L 137.05 355.53 L 120.89 351.7 L 98.32 351.7 L 82.01 355.57 L 82.01 367.9 L 98.32 367.45 L 120.89 367.45 L 137.05 368.02 L 146.1 368.69 L 143.05 368.69 L 143.05 372.29 L 146.1 372.29 L 137.05 373.09 L 120.89 374.21 L 98.32 374.21 L 82.01 373.09 L 82.01 385.22 L 98.32 388.83 L 120.89 388.83 L 137.05 385.34 L 143.05 382.42 L 143.05 384.33 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 120.89 344.95 L 120.89 330 L 137.05 337.98 L 137.05 350.14 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 120.89 351.7 L 137.05 355.53 L 137.05 368.02 L 120.89 367.45 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 120.89 374.21 L 137.05 373.09 L 137.05 385.34 L 120.89 388.83 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 120.89 395.58 L 137.05 390.63 L 137.05 403.01 L 120.89 411 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 21.02 325.04 L 21.02 314.66 L 8.45 318.35 L 0 313.69 L 0 295.06 L 14.62 294.38 L 21.02 294.84 L 21.02 285.56 L 14.63 286.03 L 0 285.25 L 0 266.5 L 8.45 261.95 L 21.02 265.73 L 21.02 254.94 L 29.99 250 L 38.97 254.94 L 38.97 265.72 L 51.55 261.95 L 60 266.61 L 60 285.33 L 45.4 286.01 L 38.97 285.56 L 38.97 294.84 L 45.38 294.38 L 60 295.05 L 60 313.69 L 51.55 318.35 L 38.97 314.66 L 38.97 325.04 L 29.99 330 Z" fill="#d9a741" stroke="none" pointer-events="none"/><path d="M 51.55 284.37 L 38.97 285.16 L 38.97 280.02 L 39.4 280.1 L 46.9 279.22 L 46.9 270 L 38.97 267.13 L 38.97 265.72 L 51.55 261.95 Z M 51.55 318.35 L 38.97 314.66 L 38.97 313.21 L 46.9 310.39 L 46.9 301.07 L 39.41 300.19 L 38.97 300.25 L 38.97 295.22 L 51.55 295.92 Z M 13.1 279.22 L 13.1 270 L 21.02 267.14 L 21.02 254.94 L 29.99 250 L 29.99 330 L 21.02 325.04 L 21.02 313.21 L 13.1 310.39 L 13.1 301.07 L 21.02 302.62 L 21.02 277.66 Z M 8.45 284.37 L 0 285.25 L 0 266.5 L 8.45 261.95 Z M 8.45 318.35 L 0 313.69 L 0 295.06 L 8.45 295.92 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 20.57 280.1 L 13.1 279.22 L 21.02 277.66 L 21.02 280.03 Z M 60 285.33 L 45.4 286.01 L 38.97 285.56 L 38.97 285.16 L 51.55 284.37 Z M 38.97 280.02 L 38.97 277.66 L 46.9 279.22 L 39.4 280.1 Z M 14.63 286.03 L 0 285.25 L 8.45 284.37 L 21.02 285.16 L 21.02 285.56 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 51.55 295.92 L 38.97 295.22 L 38.97 294.84 L 45.38 294.38 L 60 295.05 Z M 38.97 302.62 L 38.97 300.25 L 39.41 300.19 L 46.9 301.07 Z M 21.02 302.62 L 13.1 301.07 L 20.57 300.19 L 21.02 300.27 Z M 8.45 295.92 L 0 295.06 L 14.62 294.38 L 21.02 294.84 L 21.02 295.22 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 300 230 L 428.63 230" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 433.88 230 L 426.88 233.5 L 428.63 230 L 426.88 226.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 500 120 L 543.63 120" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 548.88 120 L 541.88 123.5 L 543.63 120 L 541.88 116.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 300 230 L 370 230 L 370 120 L 433.63 120" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 438.88 120 L 431.88 123.5 L 433.63 120 L 431.88 116.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 500 50.19 C 500 55.27 495.68 60 489.62 60 L 450.34 60 C 444.15 60 440 55.09 440 50.23 L 440 9.59 C 440 5.02 444.09 0 450.42 0 L 489.62 0 C 495.76 0 500 4.75 500 10.06 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 500 47.54 L 500 50.19 C 500 55.28 495.68 60 489.62 60 L 450.34 60 C 444.15 60 440 55.09 440 50.23 L 440 47.68 C 440 52.77 444.63 57.35 450.1 57.35 L 489.89 57.35 C 495.34 57.35 500 52.9 500 47.54 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="440" y="0" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 488.85 43.61 C 488.92 43.81 488.8 44 488.62 44.07 L 478.38 47.77 C 478.14 47.85 477.93 47.75 477.86 47.61 L 469.92 28.36 L 459.05 47.17 C 458.96 47.32 458.82 47.38 458.61 47.38 L 451.49 47.38 C 451.25 47.38 451 47.06 451.2 46.77 L 466.58 21.34 C 466.81 20.96 466.78 20.64 466.67 20.36 L 465.24 16.29 C 465.16 16.03 464.98 15.9 464.72 15.9 L 460.24 15.9 C 459.76 15.9 459.67 15.72 459.67 15.35 L 459.67 9.94 C 459.67 9.65 459.73 9.54 460.02 9.54 L 468.94 9.54 C 469.37 9.54 469.49 9.77 469.6 10.03 L 481.65 39.77 L 486.4 38.16 C 486.61 38.09 486.72 38.13 486.79 38.3 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 600 47.47 L 595.96 49.51 L 584.11 46.65 L 584.11 55.42 L 575 60 L 565.84 55.42 L 565.84 46.65 L 554.03 49.51 L 550 47.48 L 550 12.45 L 554.03 10.42 L 565.84 13.24 L 565.84 4.58 L 575 0 L 584.11 4.58 L 584.11 13.24 L 595.96 10.41 L 600 12.45 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 554.03 10.42 L 554.03 49.51 L 550 47.48 L 550 12.45 Z M 575 15.15 L 565.84 17.4 L 565.84 4.58 L 575 0 Z M 575 37.57 L 565.84 36.4 L 565.84 23.59 L 575 22.42 Z M 575 60 L 565.84 55.42 L 565.84 42.6 L 575 44.85 Z M 595.96 49.51 L 584.11 46.65 L 584.11 42.55 L 575 40.92 L 575 37.57 L 584.11 36.4 L 584.11 23.59 L 575 22.42 L 575 19.07 L 584.11 17.4 L 584.11 13.24 L 595.96 10.41 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 575 19.07 L 565.84 17.4 L 575 15.15 L 584.11 17.4 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 584.11 42.65 L 575 44.85 L 565.84 42.6 L 575 40.92 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 500 30 L 543.63 30" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 548.88 30 L 541.88 33.5 L 543.63 30 L 541.88 26.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 300 230 L 370 230 L 370 30 L 433.63 30" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 438.88 30 L 431.88 33.5 L 433.63 30 L 431.88 26.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(330.5,212.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="37" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: right;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Events</div></div></foreignObject><text x="19" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Events</text></switch></g><path d="M 300 350 L 428.63 350" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 433.88 350 L 426.88 353.5 L 428.63 350 L 426.88 346.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 300 350 L 370 350 L 370 550 L 433.63 550" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 438.88 550 L 431.88 553.5 L 433.63 550 L 431.88 546.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 300 350 L 370 350 L 370 460 L 433.63 460" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 438.88 460 L 431.88 463.5 L 433.63 460 L 431.88 456.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 300 370.02 C 300 375.1 295.68 379.83 289.62 379.83 L 250.34 379.83 C 244.15 379.83 240 374.93 240 370.07 L 240 329.43 C 240 324.85 244.09 319.83 250.42 319.83 L 289.62 319.83 C 295.76 319.83 300 324.58 300 329.89 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 300 367.37 L 300 370.02 C 300 375.12 295.68 379.83 289.62 379.83 L 250.34 379.83 C 244.15 379.83 240 374.93 240 370.07 L 240 367.51 C 240 372.61 244.63 377.18 250.1 377.18 L 289.89 377.18 C 295.34 377.18 300 372.74 300 367.37 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="240" y="319.83" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 288.85 363.44 C 288.92 363.65 288.8 363.83 288.62 363.91 L 278.38 367.6 C 278.14 367.69 277.93 367.59 277.86 367.44 L 269.92 348.2 L 259.05 367.01 C 258.96 367.15 258.82 367.21 258.61 367.21 L 251.49 367.21 C 251.25 367.21 251 366.89 251.2 366.6 L 266.58 341.17 C 266.81 340.8 266.78 340.48 266.67 340.19 L 265.24 336.12 C 265.16 335.86 264.98 335.73 264.72 335.73 L 260.24 335.73 C 259.76 335.73 259.67 335.56 259.67 335.18 L 259.67 329.77 C 259.67 329.48 259.73 329.37 260.02 329.37 L 268.94 329.37 C 269.37 329.37 269.49 329.6 269.6 329.86 L 281.65 359.61 L 286.4 357.99 C 286.61 357.92 286.72 357.96 286.79 358.14 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 458.55 379.83 L 442.69 371.94 L 435 362.16 L 435 353.72 L 437.2 353.5 L 437.2 351.38 L 435 350.05 L 435 341.6 L 437.2 341.6 L 437.2 338.05 L 435 338.05 L 435 329.62 L 437.2 328.27 L 437.2 326.17 L 435 325.93 L 435 317.49 L 442.69 307.71 L 458.55 299.83 L 480.5 299.83 L 496.21 307.71 L 505 317.49 L 505 325.93 L 502.04 326.15 L 502.04 328.15 L 505 329.71 L 505 338.05 L 502.04 338.05 L 502.04 341.6 L 505 341.6 L 505 350.16 L 502.04 351.6 L 502.04 353.5 L 505 353.72 L 505 362.16 L 496.21 371.94 L 480.5 379.83 Z" fill="#2e73b8" stroke="none" pointer-events="none"/><path d="M 458.55 314.6 L 442.69 319.95 L 442.69 307.71 L 458.55 299.83 Z M 458.55 336.82 L 442.69 337.26 L 442.69 325.09 L 458.55 321.27 Z M 458.55 357.94 L 442.69 354.37 L 442.69 342.39 L 458.55 343.5 Z M 458.55 379.83 L 442.69 371.94 L 442.69 359.7 L 458.55 364.61 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 505 353.72 L 496.21 359.72 L 480.5 364.61 L 458.55 364.61 L 442.69 359.7 L 442.69 371.94 L 435 362.16 L 435 353.72 L 437.2 353.5 L 437.2 351.38 L 435 350.05 L 435 341.6 L 437.2 341.6 L 437.2 338.05 L 435 338.05 L 435 329.62 L 437.2 328.27 L 437.2 326.17 L 435 325.93 L 435 317.49 L 442.69 307.71 L 442.69 319.95 L 458.55 314.6 L 480.5 314.6 L 496.21 319.73 L 505 325.93 L 502.04 326.15 L 502.04 328.15 L 496.21 325.04 L 480.5 321.27 L 458.55 321.27 L 442.69 325.09 L 442.69 337.26 L 458.55 336.82 L 480.5 336.82 L 496.21 337.38 L 505 338.05 L 502.04 338.05 L 502.04 341.6 L 505 341.6 L 496.21 342.39 L 480.5 343.5 L 458.55 343.5 L 442.69 342.39 L 442.69 354.37 L 458.55 357.94 L 480.5 357.94 L 496.21 354.49 L 502.04 351.6 L 502.04 353.5 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 480.5 314.6 L 480.5 299.83 L 496.21 307.71 L 496.21 319.73 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 480.5 321.27 L 496.21 325.04 L 496.21 337.38 L 480.5 336.82 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 480.5 343.5 L 496.21 342.39 L 496.21 354.49 L 480.5 357.94 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 480.5 364.61 L 496.21 359.72 L 496.21 371.94 L 480.5 379.83 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 500 550 L 543.63 550" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 548.88 550 L 541.88 553.5 L 543.63 550 L 541.88 546.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 500 570.02 C 500 575.1 495.68 579.83 489.62 579.83 L 450.34 579.83 C 444.15 579.83 440 574.93 440 570.07 L 440 529.43 C 440 524.85 444.09 519.83 450.42 519.83 L 489.62 519.83 C 495.76 519.83 500 524.58 500 529.89 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 500 567.37 L 500 570.02 C 500 575.12 495.68 579.83 489.62 579.83 L 450.34 579.83 C 444.15 579.83 440 574.93 440 570.07 L 440 567.51 C 440 572.61 444.63 577.18 450.1 577.18 L 489.89 577.18 C 495.34 577.18 500 572.74 500 567.37 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="440" y="519.83" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 488.85 563.44 C 488.92 563.65 488.8 563.83 488.62 563.91 L 478.38 567.6 C 478.14 567.69 477.93 567.59 477.86 567.44 L 469.92 548.2 L 459.05 567.01 C 458.96 567.15 458.82 567.21 458.61 567.21 L 451.49 567.21 C 451.25 567.21 451 566.89 451.2 566.6 L 466.58 541.17 C 466.81 540.8 466.78 540.48 466.67 540.19 L 465.24 536.12 C 465.16 535.86 464.98 535.73 464.72 535.73 L 460.24 535.73 C 459.76 535.73 459.67 535.56 459.67 535.18 L 459.67 529.77 C 459.67 529.48 459.73 529.37 460.02 529.37 L 468.94 529.37 C 469.37 529.37 469.49 529.6 469.6 529.86 L 481.65 559.61 L 486.4 557.99 C 486.61 557.92 486.72 557.96 486.79 558.14 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 600 567.31 L 595.96 569.35 L 584.11 566.48 L 584.11 575.25 L 575 579.83 L 565.84 575.25 L 565.84 566.48 L 554.03 569.35 L 550 567.32 L 550 532.28 L 554.03 530.25 L 565.84 533.07 L 565.84 524.42 L 575 519.83 L 584.11 524.42 L 584.11 533.07 L 595.96 530.24 L 600 532.28 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 554.03 530.25 L 554.03 569.35 L 550 567.32 L 550 532.28 Z M 575 534.98 L 565.84 537.23 L 565.84 524.42 L 575 519.83 Z M 575 557.4 L 565.84 556.24 L 565.84 543.42 L 575 542.25 Z M 575 579.83 L 565.84 575.25 L 565.84 562.43 L 575 564.69 Z M 595.96 569.35 L 584.11 566.48 L 584.11 562.38 L 575 560.75 L 575 557.4 L 584.11 556.24 L 584.11 543.42 L 575 542.25 L 575 538.9 L 584.11 537.23 L 584.11 533.07 L 595.96 530.24 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 575 538.9 L 565.84 537.23 L 575 534.98 L 584.11 537.23 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 584.11 562.48 L 575 564.69 L 565.84 562.43 L 575 560.75 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 500 460 L 543.63 460" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 548.88 460 L 541.88 463.5 L 543.63 460 L 541.88 456.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 500 480.02 C 500 485.1 495.68 489.83 489.62 489.83 L 450.34 489.83 C 444.15 489.83 440 484.93 440 480.07 L 440 439.43 C 440 434.85 444.09 429.83 450.42 429.83 L 489.62 429.83 C 495.76 429.83 500 434.58 500 439.89 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 500 477.37 L 500 480.02 C 500 485.12 495.68 489.83 489.62 489.83 L 450.34 489.83 C 444.15 489.83 440 484.93 440 480.07 L 440 477.51 C 440 482.61 444.63 487.18 450.1 487.18 L 489.89 487.18 C 495.34 487.18 500 482.74 500 477.37 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="440" y="429.83" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 488.85 473.44 C 488.92 473.65 488.8 473.83 488.62 473.91 L 478.38 477.6 C 478.14 477.69 477.93 477.59 477.86 477.44 L 469.92 458.2 L 459.05 477.01 C 458.96 477.15 458.82 477.21 458.61 477.21 L 451.49 477.21 C 451.25 477.21 451 476.89 451.2 476.6 L 466.58 451.17 C 466.81 450.8 466.78 450.48 466.67 450.19 L 465.24 446.12 C 465.16 445.86 464.98 445.73 464.72 445.73 L 460.24 445.73 C 459.76 445.73 459.67 445.56 459.67 445.18 L 459.67 439.77 C 459.67 439.48 459.73 439.37 460.02 439.37 L 468.94 439.37 C 469.37 439.37 469.49 439.6 469.6 439.86 L 481.65 469.61 L 486.4 467.99 C 486.61 467.92 486.72 467.96 486.79 468.14 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 600 477.31 L 595.96 479.35 L 584.11 476.48 L 584.11 485.25 L 575 489.83 L 565.84 485.25 L 565.84 476.48 L 554.03 479.35 L 550 477.32 L 550 442.28 L 554.03 440.25 L 565.84 443.07 L 565.84 434.42 L 575 429.83 L 584.11 434.42 L 584.11 443.07 L 595.96 440.24 L 600 442.28 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 554.03 440.25 L 554.03 479.35 L 550 477.32 L 550 442.28 Z M 575 444.98 L 565.84 447.23 L 565.84 434.42 L 575 429.83 Z M 575 467.4 L 565.84 466.24 L 565.84 453.42 L 575 452.25 Z M 575 489.83 L 565.84 485.25 L 565.84 472.43 L 575 474.69 Z M 595.96 479.35 L 584.11 476.48 L 584.11 472.38 L 575 470.75 L 575 467.4 L 584.11 466.24 L 584.11 453.42 L 575 452.25 L 575 448.9 L 584.11 447.23 L 584.11 443.07 L 595.96 440.24 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 575 448.9 L 565.84 447.23 L 575 444.98 L 584.11 447.23 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 584.11 472.48 L 575 474.69 L 565.84 472.43 L 575 470.75 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><g transform="translate(330.5,332.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="37" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: right;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Events</div></div></foreignObject><text x="19" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Events</text></switch></g><g transform="translate(78.5,272.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="63" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Commands</div></div></foreignObject><text x="32" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Commands</text></switch></g><g transform="translate(226.5,262.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="86" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">User Aggregate</div></div></foreignObject><text x="43" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">User Aggregate</text></switch></g><g transform="translate(216.5,383.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="107" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Channel Aggregate</div></div></foreignObject><text x="54" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Channel Aggregate</text></switch></g><g transform="translate(439.5,67.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="61" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Projections</div></div></foreignObject><text x="31" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Projections</text></switch></g><g transform="translate(439.5,497.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="61" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Projections</div></div></foreignObject><text x="31" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Projections</text></switch></g><g transform="translate(549.5,68.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="51" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">S3 Views</div></div></foreignObject><text x="26" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">S3 Views</text></switch></g><g transform="translate(549.5,497.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="51" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">S3 Views</div></div></foreignObject><text x="26" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">S3 Views</text></switch></g><g transform="translate(65.5,422.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="89" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Command Store</div></div></foreignObject><text x="45" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Command Store</text></switch></g><g transform="translate(418.5,393.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="113" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Channel Event Store</div></div></foreignObject><text x="57" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Channel Event Store</text></switch></g><g transform="translate(423.5,272.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="92" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">User Event Store</div></div></foreignObject><text x="46" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">User Event Store</text></switch></g></g></svg>
Note:
* command -> store -> router -> aggregate methods -> aggregate events
* each aggregate would create it's own eventsourcing event based on the command



<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="451px" height="321px" version="1.1"><defs/><g transform="translate(0.5,0.5)"><path d="M 39 160 L 110 160 L 110 203.63" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 110 208.88 L 106.5 201.88 L 110 203.63 L 113.5 201.88 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 340 110 L 383.63 110" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 388.88 110 L 381.88 113.5 L 383.63 110 L 381.88 106.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 340 130.19 C 340 135.27 335.68 140 329.62 140 L 290.34 140 C 284.15 140 280 135.09 280 130.23 L 280 89.59 C 280 85.02 284.09 80 290.42 80 L 329.62 80 C 335.76 80 340 84.75 340 90.06 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 340 127.54 L 340 130.19 C 340 135.28 335.68 140 329.62 140 L 290.34 140 C 284.15 140 280 135.09 280 130.23 L 280 127.68 C 280 132.77 284.63 137.35 290.1 137.35 L 329.89 137.35 C 335.34 137.35 340 132.9 340 127.54 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="280" y="80" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 328.85 123.61 C 328.92 123.81 328.8 124 328.62 124.07 L 318.38 127.77 C 318.14 127.85 317.93 127.75 317.86 127.61 L 309.92 108.36 L 299.05 127.17 C 298.96 127.32 298.82 127.38 298.61 127.38 L 291.49 127.38 C 291.25 127.38 291 127.06 291.2 126.77 L 306.58 101.34 C 306.81 100.96 306.78 100.64 306.67 100.36 L 305.24 96.29 C 305.16 96.03 304.98 95.9 304.72 95.9 L 300.24 95.9 C 299.76 95.9 299.67 95.72 299.67 95.35 L 299.67 89.94 C 299.67 89.65 299.73 89.54 300.02 89.54 L 308.94 89.54 C 309.37 89.54 309.49 89.77 309.6 90.03 L 321.65 119.77 L 326.4 118.16 C 326.61 118.09 326.72 118.13 326.79 118.3 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 440 127.47 L 435.96 129.51 L 424.11 126.65 L 424.11 135.42 L 415 140 L 405.84 135.42 L 405.84 126.65 L 394.03 129.51 L 390 127.48 L 390 92.45 L 394.03 90.42 L 405.84 93.24 L 405.84 84.58 L 415 80 L 424.11 84.58 L 424.11 93.24 L 435.96 90.41 L 440 92.45 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 394.03 90.42 L 394.03 129.51 L 390 127.48 L 390 92.45 Z M 415 95.15 L 405.84 97.4 L 405.84 84.58 L 415 80 Z M 415 117.57 L 405.84 116.4 L 405.84 103.59 L 415 102.42 Z M 415 140 L 405.84 135.42 L 405.84 122.6 L 415 124.85 Z M 435.96 129.51 L 424.11 126.65 L 424.11 122.55 L 415 120.92 L 415 117.57 L 424.11 116.4 L 424.11 103.59 L 415 102.42 L 415 99.07 L 424.11 97.4 L 424.11 93.24 L 435.96 90.41 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 415 99.07 L 405.84 97.4 L 415 95.15 L 424.11 97.4 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 424.11 122.65 L 415 124.85 L 405.84 122.6 L 415 120.92 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 98.32 291 L 82.01 283.01 L 74.1 273.11 L 74.1 264.56 L 76.36 264.33 L 76.36 262.19 L 74.1 260.84 L 74.1 252.29 L 76.36 252.29 L 76.36 248.69 L 74.1 248.69 L 74.1 240.16 L 76.36 238.79 L 76.36 236.67 L 74.1 236.43 L 74.1 227.88 L 82.01 217.98 L 98.32 210 L 120.89 210 L 137.05 217.98 L 146.1 227.88 L 146.1 236.43 L 143.05 236.65 L 143.05 238.67 L 146.1 240.25 L 146.1 248.69 L 143.05 248.69 L 143.05 252.29 L 146.1 252.29 L 146.1 260.96 L 143.05 262.42 L 143.05 264.33 L 146.1 264.56 L 146.1 273.11 L 137.05 283.01 L 120.89 291 Z" fill="#2e73b8" stroke="none" pointer-events="none"/><path d="M 98.32 224.95 L 82.01 230.37 L 82.01 217.98 L 98.32 210 Z M 98.32 247.45 L 82.01 247.9 L 82.01 235.57 L 98.32 231.7 Z M 98.32 268.83 L 82.01 265.22 L 82.01 253.09 L 98.32 254.21 Z M 98.32 291 L 82.01 283.01 L 82.01 270.62 L 98.32 275.58 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 146.1 264.56 L 137.05 270.63 L 120.89 275.58 L 98.32 275.58 L 82.01 270.62 L 82.01 283.01 L 74.1 273.11 L 74.1 264.56 L 76.36 264.33 L 76.36 262.19 L 74.1 260.84 L 74.1 252.29 L 76.36 252.29 L 76.36 248.69 L 74.1 248.69 L 74.1 240.16 L 76.36 238.79 L 76.36 236.67 L 74.1 236.43 L 74.1 227.88 L 82.01 217.98 L 82.01 230.37 L 98.32 224.95 L 120.89 224.95 L 137.05 230.14 L 146.1 236.43 L 143.05 236.65 L 143.05 238.67 L 137.05 235.53 L 120.89 231.7 L 98.32 231.7 L 82.01 235.57 L 82.01 247.9 L 98.32 247.45 L 120.89 247.45 L 137.05 248.02 L 146.1 248.69 L 143.05 248.69 L 143.05 252.29 L 146.1 252.29 L 137.05 253.09 L 120.89 254.21 L 98.32 254.21 L 82.01 253.09 L 82.01 265.22 L 98.32 268.83 L 120.89 268.83 L 137.05 265.34 L 143.05 262.42 L 143.05 264.33 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 120.89 224.95 L 120.89 210 L 137.05 217.98 L 137.05 230.14 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 120.89 231.7 L 137.05 235.53 L 137.05 248.02 L 120.89 247.45 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 120.89 254.21 L 137.05 253.09 L 137.05 265.34 L 120.89 268.83 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 120.89 275.58 L 137.05 270.63 L 137.05 283.01 L 120.89 291 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 39 160 L 190 160 L 190 30 L 273.63 30" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 278.88 30 L 271.88 33.5 L 273.63 30 L 271.88 26.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 39 160 L 190 160 L 190 110 L 273.63 110" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 278.88 110 L 271.88 113.5 L 273.63 110 L 271.88 106.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 39 160 L 190 160 L 190 210 L 273.63 210" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 278.88 210 L 271.88 213.5 L 273.63 210 L 271.88 206.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 39 160 L 190 160 L 190 290 L 273.63 290" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 278.88 290 L 271.88 293.5 L 273.63 290 L 271.88 286.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 21.02 195.04 L 21.02 184.66 L 8.45 188.35 L 0 183.69 L 0 165.06 L 14.62 164.38 L 21.02 164.84 L 21.02 155.56 L 14.63 156.03 L 0 155.25 L 0 136.5 L 8.45 131.95 L 21.02 135.73 L 21.02 124.94 L 29.99 120 L 38.97 124.94 L 38.97 135.72 L 51.55 131.95 L 60 136.61 L 60 155.33 L 45.4 156.01 L 38.97 155.56 L 38.97 164.84 L 45.38 164.38 L 60 165.05 L 60 183.69 L 51.55 188.35 L 38.97 184.66 L 38.97 195.04 L 29.99 200 Z" fill="#d9a741" stroke="none" pointer-events="none"/><path d="M 51.55 154.37 L 38.97 155.16 L 38.97 150.02 L 39.4 150.1 L 46.9 149.22 L 46.9 140 L 38.97 137.13 L 38.97 135.72 L 51.55 131.95 Z M 51.55 188.35 L 38.97 184.66 L 38.97 183.21 L 46.9 180.39 L 46.9 171.07 L 39.41 170.19 L 38.97 170.25 L 38.97 165.22 L 51.55 165.92 Z M 13.1 149.22 L 13.1 140 L 21.02 137.14 L 21.02 124.94 L 29.99 120 L 29.99 200 L 21.02 195.04 L 21.02 183.21 L 13.1 180.39 L 13.1 171.07 L 21.02 172.62 L 21.02 147.66 Z M 8.45 154.37 L 0 155.25 L 0 136.5 L 8.45 131.95 Z M 8.45 188.35 L 0 183.69 L 0 165.06 L 8.45 165.92 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 20.57 150.1 L 13.1 149.22 L 21.02 147.66 L 21.02 150.03 Z M 60 155.33 L 45.4 156.01 L 38.97 155.56 L 38.97 155.16 L 51.55 154.37 Z M 38.97 150.02 L 38.97 147.66 L 46.9 149.22 L 39.4 150.1 Z M 14.63 156.03 L 0 155.25 L 8.45 154.37 L 21.02 155.16 L 21.02 155.56 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 51.55 165.92 L 38.97 165.22 L 38.97 164.84 L 45.38 164.38 L 60 165.05 Z M 38.97 172.62 L 38.97 170.25 L 39.41 170.19 L 46.9 171.07 Z M 21.02 172.62 L 13.1 171.07 L 20.57 170.19 L 21.02 170.27 Z M 8.45 165.92 L 0 165.06 L 14.62 164.38 L 21.02 164.84 L 21.02 165.22 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 340 30 L 383.63 30" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 388.88 30 L 381.88 33.5 L 383.63 30 L 381.88 26.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 340 50.19 C 340 55.27 335.68 60 329.62 60 L 290.34 60 C 284.15 60 280 55.09 280 50.23 L 280 9.59 C 280 5.02 284.09 0 290.42 0 L 329.62 0 C 335.76 0 340 4.75 340 10.06 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 340 47.54 L 340 50.19 C 340 55.28 335.68 60 329.62 60 L 290.34 60 C 284.15 60 280 55.09 280 50.23 L 280 47.68 C 280 52.77 284.63 57.35 290.1 57.35 L 329.89 57.35 C 335.34 57.35 340 52.9 340 47.54 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="280" y="0" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 328.85 43.61 C 328.92 43.81 328.8 44 328.62 44.07 L 318.38 47.77 C 318.14 47.85 317.93 47.75 317.86 47.61 L 309.92 28.36 L 299.05 47.17 C 298.96 47.32 298.82 47.38 298.61 47.38 L 291.49 47.38 C 291.25 47.38 291 47.06 291.2 46.77 L 306.58 21.34 C 306.81 20.96 306.78 20.64 306.67 20.36 L 305.24 16.29 C 305.16 16.03 304.98 15.9 304.72 15.9 L 300.24 15.9 C 299.76 15.9 299.67 15.72 299.67 15.35 L 299.67 9.94 C 299.67 9.65 299.73 9.54 300.02 9.54 L 308.94 9.54 C 309.37 9.54 309.49 9.77 309.6 10.03 L 321.65 39.77 L 326.4 38.16 C 326.61 38.09 326.72 38.13 326.79 38.3 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 440 47.47 L 435.96 49.51 L 424.11 46.65 L 424.11 55.42 L 415 60 L 405.84 55.42 L 405.84 46.65 L 394.03 49.51 L 390 47.48 L 390 12.45 L 394.03 10.42 L 405.84 13.24 L 405.84 4.58 L 415 0 L 424.11 4.58 L 424.11 13.24 L 435.96 10.41 L 440 12.45 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 394.03 10.42 L 394.03 49.51 L 390 47.48 L 390 12.45 Z M 415 15.15 L 405.84 17.4 L 405.84 4.58 L 415 0 Z M 415 37.57 L 405.84 36.4 L 405.84 23.59 L 415 22.42 Z M 415 60 L 405.84 55.42 L 405.84 42.6 L 415 44.85 Z M 435.96 49.51 L 424.11 46.65 L 424.11 42.55 L 415 40.92 L 415 37.57 L 424.11 36.4 L 424.11 23.59 L 415 22.42 L 415 19.07 L 424.11 17.4 L 424.11 13.24 L 435.96 10.41 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 415 19.07 L 405.84 17.4 L 415 15.15 L 424.11 17.4 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 424.11 42.65 L 415 44.85 L 405.84 42.6 L 415 40.92 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 340 290 L 383.63 290" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 388.88 290 L 381.88 293.5 L 383.63 290 L 381.88 286.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 340 310.02 C 340 315.1 335.68 319.83 329.62 319.83 L 290.34 319.83 C 284.15 319.83 280 314.93 280 310.07 L 280 269.43 C 280 264.85 284.09 259.83 290.42 259.83 L 329.62 259.83 C 335.76 259.83 340 264.58 340 269.89 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 340 307.37 L 340 310.02 C 340 315.12 335.68 319.83 329.62 319.83 L 290.34 319.83 C 284.15 319.83 280 314.93 280 310.07 L 280 307.51 C 280 312.61 284.63 317.18 290.1 317.18 L 329.89 317.18 C 335.34 317.18 340 312.74 340 307.37 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="280" y="259.83" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 328.85 303.44 C 328.92 303.65 328.8 303.83 328.62 303.91 L 318.38 307.6 C 318.14 307.69 317.93 307.59 317.86 307.44 L 309.92 288.2 L 299.05 307.01 C 298.96 307.15 298.82 307.21 298.61 307.21 L 291.49 307.21 C 291.25 307.21 291 306.89 291.2 306.6 L 306.58 281.17 C 306.81 280.8 306.78 280.48 306.67 280.19 L 305.24 276.12 C 305.16 275.86 304.98 275.73 304.72 275.73 L 300.24 275.73 C 299.76 275.73 299.67 275.56 299.67 275.18 L 299.67 269.77 C 299.67 269.48 299.73 269.37 300.02 269.37 L 308.94 269.37 C 309.37 269.37 309.49 269.6 309.6 269.86 L 321.65 299.61 L 326.4 297.99 C 326.61 297.92 326.72 297.96 326.79 298.14 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 440 307.31 L 435.96 309.35 L 424.11 306.48 L 424.11 315.25 L 415 319.83 L 405.84 315.25 L 405.84 306.48 L 394.03 309.35 L 390 307.32 L 390 272.28 L 394.03 270.25 L 405.84 273.07 L 405.84 264.42 L 415 259.83 L 424.11 264.42 L 424.11 273.07 L 435.96 270.24 L 440 272.28 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 394.03 270.25 L 394.03 309.35 L 390 307.32 L 390 272.28 Z M 415 274.98 L 405.84 277.23 L 405.84 264.42 L 415 259.83 Z M 415 297.4 L 405.84 296.24 L 405.84 283.42 L 415 282.25 Z M 415 319.83 L 405.84 315.25 L 405.84 302.43 L 415 304.69 Z M 435.96 309.35 L 424.11 306.48 L 424.11 302.38 L 415 300.75 L 415 297.4 L 424.11 296.24 L 424.11 283.42 L 415 282.25 L 415 278.9 L 424.11 277.23 L 424.11 273.07 L 435.96 270.24 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 415 278.9 L 405.84 277.23 L 415 274.98 L 424.11 277.23 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 424.11 302.48 L 415 304.69 L 405.84 302.43 L 415 300.75 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 340 210 L 383.63 210" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 388.88 210 L 381.88 213.5 L 383.63 210 L 381.88 206.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 340 230.02 C 340 235.1 335.68 239.83 329.62 239.83 L 290.34 239.83 C 284.15 239.83 280 234.93 280 230.07 L 280 189.43 C 280 184.85 284.09 179.83 290.42 179.83 L 329.62 179.83 C 335.76 179.83 340 184.58 340 189.89 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 340 227.37 L 340 230.02 C 340 235.12 335.68 239.83 329.62 239.83 L 290.34 239.83 C 284.15 239.83 280 234.93 280 230.07 L 280 227.51 C 280 232.61 284.63 237.18 290.1 237.18 L 329.89 237.18 C 335.34 237.18 340 232.74 340 227.37 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="280" y="179.83" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 328.85 223.44 C 328.92 223.65 328.8 223.83 328.62 223.91 L 318.38 227.6 C 318.14 227.69 317.93 227.59 317.86 227.44 L 309.92 208.2 L 299.05 227.01 C 298.96 227.15 298.82 227.21 298.61 227.21 L 291.49 227.21 C 291.25 227.21 291 226.89 291.2 226.6 L 306.58 201.17 C 306.81 200.8 306.78 200.48 306.67 200.19 L 305.24 196.12 C 305.16 195.86 304.98 195.73 304.72 195.73 L 300.24 195.73 C 299.76 195.73 299.67 195.56 299.67 195.18 L 299.67 189.77 C 299.67 189.48 299.73 189.37 300.02 189.37 L 308.94 189.37 C 309.37 189.37 309.49 189.6 309.6 189.86 L 321.65 219.61 L 326.4 217.99 C 326.61 217.92 326.72 217.96 326.79 218.14 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 440 227.31 L 435.96 229.35 L 424.11 226.48 L 424.11 235.25 L 415 239.83 L 405.84 235.25 L 405.84 226.48 L 394.03 229.35 L 390 227.32 L 390 192.28 L 394.03 190.25 L 405.84 193.07 L 405.84 184.42 L 415 179.83 L 424.11 184.42 L 424.11 193.07 L 435.96 190.24 L 440 192.28 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 394.03 190.25 L 394.03 229.35 L 390 227.32 L 390 192.28 Z M 415 194.98 L 405.84 197.23 L 405.84 184.42 L 415 179.83 Z M 415 217.4 L 405.84 216.24 L 405.84 203.42 L 415 202.25 Z M 415 239.83 L 405.84 235.25 L 405.84 222.43 L 415 224.69 Z M 435.96 229.35 L 424.11 226.48 L 424.11 222.38 L 415 220.75 L 415 217.4 L 424.11 216.24 L 424.11 203.42 L 415 202.25 L 415 198.9 L 424.11 197.23 L 424.11 193.07 L 435.96 190.24 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 415 198.9 L 405.84 197.23 L 415 194.98 L 424.11 197.23 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 424.11 222.48 L 415 224.69 L 405.84 222.43 L 415 220.75 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><g transform="translate(76.5,142.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="37" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Events</div></div></foreignObject><text x="19" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Events</text></switch></g><g transform="translate(279.5,152.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="61" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Projections</div></div></foreignObject><text x="31" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Projections</text></switch></g><g transform="translate(389.5,152.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="51" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">S3 Views</div></div></foreignObject><text x="26" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">S3 Views</text></switch></g><g transform="translate(78.5,302.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="63" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Event Store</div></div></foreignObject><text x="32" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Event Store</text></switch></g></g></svg>
Note:
* event -> store -> router -> aggregate
* events from the ui get sent to each
* storing in a single stream helps here, we can re-process events to make the split later



![kafka logs](img/log_consumer.png)
https://kafka.apache.org/intro <!-- .element: class="image-attribution"-->
Note:
* Kafka would be pretty ideal for this
* But it's not serverless



## Kinesis
![Kinesis](img/AWS-Summit_recap_KinesisStreams.png)
Note:
* Kinesis streams are pretty similar to Kafka
* But there is a problem, we want permanent log storage
* "the retention period and is configurable in hourly increments from 1 to 7 days."
* choice:
  * use kafka (ec2/docker)
  * work around Kinesis
  * something else
* not going to break the serverless requirement that easily!
  * events will have timestamps & uuids
  * so store in rds/dynamo
  * if an aggregate needs stream position, it can store last-read uuid



## Aggregates
note:
* we only need two aggregates to start with
* channels are the primary aggregate
* has messages, users watching



```c#
public class ChannelAggregate : AggregateRoot
{
  public void Join(User user)
  {
    //validation...

    var e = new UserJoinedChannelEvent(userId: user.id, channelId: this.id);
    Apply(e);
  }

  private void Handle(UserJoinedChannelEvent e)
  {
    _users.Add(e.UserId);
  }
}
```
Note:
* event creation happens within the aggregate (commands to api)
* handler execution is called by `Apply` and by loading
* Projections are elsewhere



```c#
public class ChannelProjection : Projection
{
  public IEnumerable<string> => _users;
  public string Name { get; private set; }
  public string Description { get; private set; }

  private readonly HashSet<string> _users;

  private void Handle(UserJoinedChannelEvent e)
  {
    _users.Add(_userView.GetOrDefault(e.UserId).Name);
  }

  private void Handle(ChannelCreatedEvent e)
  {
    Name = e.Name;
    Description = e.Description;
  }
}
```
Note:
* uses a userview projection/service to get usernames from the id
* this would be async to saving of events
* we have the option of splitting the aggregates
  * public methods clientside
  * handlers serverside



```c#
public class ChannelAggregate
{
  public void Join(User user)
  {
    //validation...

    var e = new UserJoinedChannelEvent(
      userId: user.id,
      channelId: this.id);

    Apply(e);
  }

  void Handle(UserJoinedChannelEvent e)
  {
    _users.Add(e.UserId);
  }
}

public class ChannelProjection
{
  void Handle(UserJoinedChannelEvent e)
  {
    _users.Add(_userView
      .GetOrDefault(e.UserId)
      .Name);
  }
}
```
<!-- .element: class="left"-->
```javascript
//client side:
const join = user =>
{
  var event = CreateEvent({
    userId: user.id,
    channelId: this.id);
  });

  Validate(this, event);
  Dispatch(event);
}
```
<!-- .element: class="right fragment"-->
```javascript
//serverside sync
const onEvent = event => {
  Store(event);
  TriggerProjections(event);
}
```
<!-- .element: class="right fragment"-->
```javascript
//serverside async
const channelProjection = event => {
  const handler = handlers[event.type];
  handler(view, event);
}
```
<!-- .element: class="right fragment"-->
Note:
* it's now javascript
* clientside `Dispatch` is in browser, calls api-gateway
* serverside sync is lambda which responds with ok if the event was stored
* serverside async is lamdbas for projecting events into views
* protect the api to logged in users using cognito



```javascript
exports.handler = function(awsEvent, context, callback) {

  const metadata = {
    timestamp: new Date().getTime(),
    eventId: uuid()
  }

  const event = Object.assign(
    {},
    JSON.parse(awsEvent.body),
    metadata)

  writeToStorage(event)
    .then(data => triggerAggregates(event)
    .then(data => sendOkResponse(callback)))
}
```
Note:
* error handling has been omitted
* the lambda controls the timestamp and eventId
* no sequence number used
  * don't want to cause blocking resource
  * ordering by date should be good enough
  * this could be solved using rds postgres with a `serial` column



```javascript
const handlers = {
  CHANNEL_CREATED: (view, event) => {
    return view.concat([createChannel(event)])
  },

  USER_JOINED_CHANNEL: (view, event) => {
    return updateChannel(view, event.channelId, existing => {
      return { users: existing.users + 1 }
    })
  }
}

module.exports = event => {
  const handler = handlers[event.type]

  return {
    viewName: 'allchannels',
    defaultView: [],
    callback: view => handler(view, event)
  }
}
```
Note:
* views are just json files in s3
* `updateView` is a function which upserts them



```javascript
const updateView = ({s3 = new S3(), defaultView = {}, viewName, id, cb}) => {
  const path = id
    ? `events/views/${viewName}.json`
    : `events/views/${viewName}/${id}.json`

  return new Promise((resolve, reject) => {
    s3.getObject({ Bucket: 'crowbar-store', Key: key }, (err, data) => {

      const body = data && data.Body
        ? JSON.parse(data.Body)
        : defaultView

      const content = cb(body) || body

      const command = {
        Bucket: 'crowbar-store',
        Key: key,
        Body: JSON.stringify(content, null, 2),
        ContentType: 'application/json',
        ACL: 'public-read'
      }

      s3.putObject(command, (err, data) => resolve())
    })
  })
}
```
Note:
* again no error handling, or most-recent update time
* this has some consistency problems which we will go through later too



![high level architecture](img/crowbar-architecture.png)
Note:
* a static website deployed to s3 (react based)
* an api-gateway, protected by cognito
* a lambda to receive events from the website
* one lambda per aggregate root to process events
* views stored as json in s3
* static site loads s3 objects
* n.b., not really using the event storage for anything yet



# Scalability?
Note:
* to a point, there are issues however
* s3 updates are potentially lossy
* also entries could appear out of order
  * especially if you are getting multiple messages a second



![sns](img/crowbar-architecture-sns.png)
Note:
* use sns and sqs
* sns will publish a message to multiple sqs queues
* have one aggregate per queue
* this enforces in-order messaage processing
* why not do this to start with? start with mvp



<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="530px" height="321px" version="1.1"><defs/><g transform="translate(0.5,0.5)"><path d="M 429 110 L 472.63 110" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 477.88 110 L 470.88 113.5 L 472.63 110 L 470.88 106.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 429 130.19 C 429 135.27 424.68 140 418.62 140 L 379.34 140 C 373.15 140 369 135.09 369 130.23 L 369 89.59 C 369 85.02 373.09 80 379.42 80 L 418.62 80 C 424.76 80 429 84.75 429 90.06 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 429 127.54 L 429 130.19 C 429 135.28 424.68 140 418.62 140 L 379.34 140 C 373.15 140 369 135.09 369 130.23 L 369 127.68 C 369 132.77 373.63 137.35 379.1 137.35 L 418.89 137.35 C 424.34 137.35 429 132.9 429 127.54 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="369" y="80" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 417.85 123.61 C 417.92 123.81 417.8 124 417.62 124.07 L 407.38 127.77 C 407.14 127.85 406.93 127.75 406.86 127.61 L 398.92 108.36 L 388.05 127.17 C 387.96 127.32 387.82 127.38 387.61 127.38 L 380.49 127.38 C 380.25 127.38 380 127.06 380.2 126.77 L 395.58 101.34 C 395.81 100.96 395.78 100.64 395.67 100.36 L 394.24 96.29 C 394.16 96.03 393.98 95.9 393.72 95.9 L 389.24 95.9 C 388.76 95.9 388.67 95.72 388.67 95.35 L 388.67 89.94 C 388.67 89.65 388.73 89.54 389.02 89.54 L 397.94 89.54 C 398.37 89.54 398.49 89.77 398.6 90.03 L 410.65 119.77 L 415.4 118.16 C 415.61 118.09 415.72 118.13 415.79 118.3 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 529 127.47 L 524.96 129.51 L 513.11 126.65 L 513.11 135.42 L 504 140 L 494.84 135.42 L 494.84 126.65 L 483.03 129.51 L 479 127.48 L 479 92.45 L 483.03 90.42 L 494.84 93.24 L 494.84 84.58 L 504 80 L 513.11 84.58 L 513.11 93.24 L 524.96 90.41 L 529 92.45 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 483.03 90.42 L 483.03 129.51 L 479 127.48 L 479 92.45 Z M 504 95.15 L 494.84 97.4 L 494.84 84.58 L 504 80 Z M 504 117.57 L 494.84 116.4 L 494.84 103.59 L 504 102.42 Z M 504 140 L 494.84 135.42 L 494.84 122.6 L 504 124.85 Z M 524.96 129.51 L 513.11 126.65 L 513.11 122.55 L 504 120.92 L 504 117.57 L 513.11 116.4 L 513.11 103.59 L 504 102.42 L 504 99.07 L 513.11 97.4 L 513.11 93.24 L 524.96 90.41 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 504 99.07 L 494.84 97.4 L 504 95.15 L 513.11 97.4 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 513.11 122.65 L 504 124.85 L 494.84 122.6 L 504 120.92 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 71 160 L 122.63 160" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 127.88 160 L 120.88 163.5 L 122.63 160 L 120.88 156.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 29.86 195 L 15.81 188.09 L 9 179.54 L 9 172.15 L 10.95 171.96 L 10.95 170.1 L 9 168.94 L 9 161.55 L 10.95 161.55 L 10.95 158.44 L 9 158.44 L 9 151.06 L 10.95 149.88 L 10.95 148.04 L 9 147.84 L 9 140.45 L 15.81 131.9 L 29.86 125 L 49.3 125 L 63.21 131.9 L 71 140.45 L 71 147.84 L 68.38 148.03 L 68.38 149.78 L 71 151.14 L 71 158.44 L 68.38 158.44 L 68.38 161.55 L 71 161.55 L 71 169.04 L 68.38 170.3 L 68.38 171.96 L 71 172.15 L 71 179.54 L 63.21 188.09 L 49.3 195 Z" fill="#2e73b8" stroke="none" pointer-events="none"/><path d="M 29.86 137.92 L 15.81 142.6 L 15.81 131.9 L 29.86 125 Z M 29.86 157.36 L 15.81 157.75 L 15.81 147.1 L 29.86 143.75 Z M 29.86 175.84 L 15.81 172.72 L 15.81 162.24 L 29.86 163.21 Z M 29.86 195 L 15.81 188.09 L 15.81 177.39 L 29.86 181.68 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 71 172.15 L 63.21 177.4 L 49.3 181.68 L 29.86 181.68 L 15.81 177.39 L 15.81 188.09 L 9 179.54 L 9 172.15 L 10.95 171.96 L 10.95 170.1 L 9 168.94 L 9 161.55 L 10.95 161.55 L 10.95 158.44 L 9 158.44 L 9 151.06 L 10.95 149.88 L 10.95 148.04 L 9 147.84 L 9 140.45 L 15.81 131.9 L 15.81 142.6 L 29.86 137.92 L 49.3 137.92 L 63.21 142.41 L 71 147.84 L 68.38 148.03 L 68.38 149.78 L 63.21 147.06 L 49.3 143.75 L 29.86 143.75 L 15.81 147.1 L 15.81 157.75 L 29.86 157.36 L 49.3 157.36 L 63.21 157.86 L 71 158.44 L 68.38 158.44 L 68.38 161.55 L 71 161.55 L 63.21 162.24 L 49.3 163.21 L 29.86 163.21 L 15.81 162.24 L 15.81 172.72 L 29.86 175.84 L 49.3 175.84 L 63.21 172.82 L 68.38 170.3 L 68.38 171.96 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 49.3 137.92 L 49.3 125 L 63.21 131.9 L 63.21 142.41 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 49.3 143.75 L 63.21 147.06 L 63.21 157.86 L 49.3 157.36 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 49.3 163.21 L 63.21 162.24 L 63.21 172.82 L 49.3 175.84 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 49.3 181.68 L 63.21 177.4 L 63.21 188.09 L 49.3 195 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 189 160 L 279 160 L 279 30 L 362.63 30" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 367.88 30 L 360.88 33.5 L 362.63 30 L 360.88 26.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 189 160 L 279 160 L 279 110 L 362.63 110" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 367.88 110 L 360.88 113.5 L 362.63 110 L 360.88 106.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 189 160 L 279 160 L 279 210 L 362.63 210" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 367.88 210 L 360.88 213.5 L 362.63 210 L 360.88 206.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 189 160 L 279 160 L 279 290 L 362.63 290" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 367.88 290 L 360.88 293.5 L 362.63 290 L 360.88 286.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 429 30 L 472.63 30" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 477.88 30 L 470.88 33.5 L 472.63 30 L 470.88 26.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 429 50.19 C 429 55.27 424.68 60 418.62 60 L 379.34 60 C 373.15 60 369 55.09 369 50.23 L 369 9.59 C 369 5.02 373.09 0 379.42 0 L 418.62 0 C 424.76 0 429 4.75 429 10.06 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 429 47.54 L 429 50.19 C 429 55.28 424.68 60 418.62 60 L 379.34 60 C 373.15 60 369 55.09 369 50.23 L 369 47.68 C 369 52.77 373.63 57.35 379.1 57.35 L 418.89 57.35 C 424.34 57.35 429 52.9 429 47.54 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="369" y="0" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 417.85 43.61 C 417.92 43.81 417.8 44 417.62 44.07 L 407.38 47.77 C 407.14 47.85 406.93 47.75 406.86 47.61 L 398.92 28.36 L 388.05 47.17 C 387.96 47.32 387.82 47.38 387.61 47.38 L 380.49 47.38 C 380.25 47.38 380 47.06 380.2 46.77 L 395.58 21.34 C 395.81 20.96 395.78 20.64 395.67 20.36 L 394.24 16.29 C 394.16 16.03 393.98 15.9 393.72 15.9 L 389.24 15.9 C 388.76 15.9 388.67 15.72 388.67 15.35 L 388.67 9.94 C 388.67 9.65 388.73 9.54 389.02 9.54 L 397.94 9.54 C 398.37 9.54 398.49 9.77 398.6 10.03 L 410.65 39.77 L 415.4 38.16 C 415.61 38.09 415.72 38.13 415.79 38.3 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 529 47.47 L 524.96 49.51 L 513.11 46.65 L 513.11 55.42 L 504 60 L 494.84 55.42 L 494.84 46.65 L 483.03 49.51 L 479 47.48 L 479 12.45 L 483.03 10.42 L 494.84 13.24 L 494.84 4.58 L 504 0 L 513.11 4.58 L 513.11 13.24 L 524.96 10.41 L 529 12.45 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 483.03 10.42 L 483.03 49.51 L 479 47.48 L 479 12.45 Z M 504 15.15 L 494.84 17.4 L 494.84 4.58 L 504 0 Z M 504 37.57 L 494.84 36.4 L 494.84 23.59 L 504 22.42 Z M 504 60 L 494.84 55.42 L 494.84 42.6 L 504 44.85 Z M 524.96 49.51 L 513.11 46.65 L 513.11 42.55 L 504 40.92 L 504 37.57 L 513.11 36.4 L 513.11 23.59 L 504 22.42 L 504 19.07 L 513.11 17.4 L 513.11 13.24 L 524.96 10.41 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 504 19.07 L 494.84 17.4 L 504 15.15 L 513.11 17.4 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 513.11 42.65 L 504 44.85 L 494.84 42.6 L 504 40.92 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 429 290 L 472.63 290" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 477.88 290 L 470.88 293.5 L 472.63 290 L 470.88 286.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 429 310.02 C 429 315.1 424.68 319.83 418.62 319.83 L 379.34 319.83 C 373.15 319.83 369 314.93 369 310.07 L 369 269.43 C 369 264.85 373.09 259.83 379.42 259.83 L 418.62 259.83 C 424.76 259.83 429 264.58 429 269.89 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 429 307.37 L 429 310.02 C 429 315.12 424.68 319.83 418.62 319.83 L 379.34 319.83 C 373.15 319.83 369 314.93 369 310.07 L 369 307.51 C 369 312.61 373.63 317.18 379.1 317.18 L 418.89 317.18 C 424.34 317.18 429 312.74 429 307.37 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="369" y="259.83" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 417.85 303.44 C 417.92 303.65 417.8 303.83 417.62 303.91 L 407.38 307.6 C 407.14 307.69 406.93 307.59 406.86 307.44 L 398.92 288.2 L 388.05 307.01 C 387.96 307.15 387.82 307.21 387.61 307.21 L 380.49 307.21 C 380.25 307.21 380 306.89 380.2 306.6 L 395.58 281.17 C 395.81 280.8 395.78 280.48 395.67 280.19 L 394.24 276.12 C 394.16 275.86 393.98 275.73 393.72 275.73 L 389.24 275.73 C 388.76 275.73 388.67 275.56 388.67 275.18 L 388.67 269.77 C 388.67 269.48 388.73 269.37 389.02 269.37 L 397.94 269.37 C 398.37 269.37 398.49 269.6 398.6 269.86 L 410.65 299.61 L 415.4 297.99 C 415.61 297.92 415.72 297.96 415.79 298.14 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 529 307.31 L 524.96 309.35 L 513.11 306.48 L 513.11 315.25 L 504 319.83 L 494.84 315.25 L 494.84 306.48 L 483.03 309.35 L 479 307.32 L 479 272.28 L 483.03 270.25 L 494.84 273.07 L 494.84 264.42 L 504 259.83 L 513.11 264.42 L 513.11 273.07 L 524.96 270.24 L 529 272.28 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 483.03 270.25 L 483.03 309.35 L 479 307.32 L 479 272.28 Z M 504 274.98 L 494.84 277.23 L 494.84 264.42 L 504 259.83 Z M 504 297.4 L 494.84 296.24 L 494.84 283.42 L 504 282.25 Z M 504 319.83 L 494.84 315.25 L 494.84 302.43 L 504 304.69 Z M 524.96 309.35 L 513.11 306.48 L 513.11 302.38 L 504 300.75 L 504 297.4 L 513.11 296.24 L 513.11 283.42 L 504 282.25 L 504 278.9 L 513.11 277.23 L 513.11 273.07 L 524.96 270.24 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 504 278.9 L 494.84 277.23 L 504 274.98 L 513.11 277.23 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 513.11 302.48 L 504 304.69 L 494.84 302.43 L 504 300.75 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 429 210 L 472.63 210" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 477.88 210 L 470.88 213.5 L 472.63 210 L 470.88 206.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="none"/><path d="M 429 230.02 C 429 235.1 424.68 239.83 418.62 239.83 L 379.34 239.83 C 373.15 239.83 369 234.93 369 230.07 L 369 189.43 C 369 184.85 373.09 179.83 379.42 179.83 L 418.62 179.83 C 424.76 179.83 429 184.58 429 189.89 Z" fill="#5294cf" stroke="none" pointer-events="none"/><path d="M 429 227.37 L 429 230.02 C 429 235.12 424.68 239.83 418.62 239.83 L 379.34 239.83 C 373.15 239.83 369 234.93 369 230.07 L 369 227.51 C 369 232.61 373.63 237.18 379.1 237.18 L 418.89 237.18 C 424.34 237.18 429 232.74 429 227.37 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><rect x="369" y="179.83" width="0" height="0" fill="none" stroke="#000000" pointer-events="none"/><path d="M 417.85 223.44 C 417.92 223.65 417.8 223.83 417.62 223.91 L 407.38 227.6 C 407.14 227.69 406.93 227.59 406.86 227.44 L 398.92 208.2 L 388.05 227.01 C 387.96 227.15 387.82 227.21 387.61 227.21 L 380.49 227.21 C 380.25 227.21 380 226.89 380.2 226.6 L 395.58 201.17 C 395.81 200.8 395.78 200.48 395.67 200.19 L 394.24 196.12 C 394.16 195.86 393.98 195.73 393.72 195.73 L 389.24 195.73 C 388.76 195.73 388.67 195.56 388.67 195.18 L 388.67 189.77 C 388.67 189.48 388.73 189.37 389.02 189.37 L 397.94 189.37 C 398.37 189.37 398.49 189.6 398.6 189.86 L 410.65 219.61 L 415.4 217.99 C 415.61 217.92 415.72 217.96 415.79 218.14 Z" fill="#ffffff" stroke="none" pointer-events="none"/><path d="M 529 227.31 L 524.96 229.35 L 513.11 226.48 L 513.11 235.25 L 504 239.83 L 494.84 235.25 L 494.84 226.48 L 483.03 229.35 L 479 227.32 L 479 192.28 L 483.03 190.25 L 494.84 193.07 L 494.84 184.42 L 504 179.83 L 513.11 184.42 L 513.11 193.07 L 524.96 190.24 L 529 192.28 Z" fill="#e05243" stroke="none" pointer-events="none"/><path d="M 483.03 190.25 L 483.03 229.35 L 479 227.32 L 479 192.28 Z M 504 194.98 L 494.84 197.23 L 494.84 184.42 L 504 179.83 Z M 504 217.4 L 494.84 216.24 L 494.84 203.42 L 504 202.25 Z M 504 239.83 L 494.84 235.25 L 494.84 222.43 L 504 224.69 Z M 524.96 229.35 L 513.11 226.48 L 513.11 222.38 L 504 220.75 L 504 217.4 L 513.11 216.24 L 513.11 203.42 L 504 202.25 L 504 198.9 L 513.11 197.23 L 513.11 193.07 L 524.96 190.24 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 504 198.9 L 494.84 197.23 L 504 194.98 L 513.11 197.23 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 513.11 222.48 L 504 224.69 L 494.84 222.43 L 504 220.75 Z" fill-opacity="0.5" fill="#ffffff" stroke="none" pointer-events="none"/><g transform="translate(215.5,142.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="37" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Events</div></div></foreignObject><text x="19" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Events</text></switch></g><g transform="translate(368.5,152.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="61" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Projections</div></div></foreignObject><text x="31" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Projections</text></switch></g><g transform="translate(487.5,152.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="33" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Views</div></div></foreignObject><text x="17" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Views</text></switch></g><g transform="translate(8.5,202.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="63" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Event Store</div></div></foreignObject><text x="32" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">Event Store</text></switch></g><path d="M 158.99 195 L 129 180.48 L 129 139.53 L 158.99 125 L 189 139.53 L 189 147.69 L 163.49 150.75 L 163.49 151.65 L 189 154.83 L 189 165.18 L 163.49 168.29 L 163.49 169.27 L 189 172.32 L 189 180.47 Z" fill="#d9a741" stroke="none" pointer-events="none"/><path d="M 143.96 167.05 L 136.84 166.21 L 136.84 153.8 L 143.96 152.95 Z M 158.99 168.83 L 147.91 167.48 L 147.91 152.46 L 158.99 151.09 Z M 158.99 195 L 129 180.48 L 129 139.53 L 158.99 125 L 158.99 139.02 L 132.87 146.58 L 132.87 173.42 L 158.99 180.99 Z" fill-opacity="0.3" fill="#000000" stroke="none" pointer-events="none"/><path d="M 163.49 150.75 L 132.87 146.58 L 158.99 139.02 L 189 147.69 Z" fill-opacity="0.5" fill="#000000" stroke="none" pointer-events="none"/><path d="M 163.49 169.27 L 189 172.32 L 158.99 180.99 L 132.87 173.42 Z" fill-opacity="0.3" fill="#ffffff" stroke="none" pointer-events="none"/><g transform="translate(146.5,212.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="25" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">SQS</div></div></foreignObject><text x="13" y="12" fill="#FFFFFF" text-anchor="middle" font-size="12px" font-family="Helvetica">SQS</text></switch></g></g></svg>
Note:
* should be fairly simple to manage
* for each event, sns -> sqs it
* or for a specific aggregate, just event -> sqs
